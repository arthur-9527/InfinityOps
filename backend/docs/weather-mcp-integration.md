# 中国天气查询MCP服务集成文档

本文档描述了如何在InfinityOps系统中使用和配置中国天气查询MCP服务。

## 概述

中国天气查询MCP服务允许用户通过自然语言查询不同城市的天气情况，支持中文查询，并能处理当前天气和未来天气预报的查询请求。

## 配置

要使用中国天气查询MCP服务，需要在`.env`文件中配置以下环境变量：

```
# 天气查询MCP服务配置
WEATHER_MCP_URL=http://localhost:5001  # 天气MCP服务器URL
WEATHER_MCP_API_KEY=your-api-key-here  # API密钥（如需要）
```

## 运行服务

天气查询MCP服务已经在系统启动时自动集成。只需确保：

1. 天气MCP服务器在端口5001上运行
2. `.env`文件中的配置正确

无需额外的启动步骤，当InfinityOps后端服务启动时（使用`pnpm start`或`pnpm dev`），天气MCP服务会自动注册并初始化。

## 增强的天气查询检测系统

本集成包含一个智能检测系统，可以识别各种形式的天气查询请求，包括但不限于：

- "北京今天天气如何？" - 标准天气查询
- "上海明天会下雨吗？" - 雨天预测查询
- "广州的气温是多少？" - 温度查询
- "武汉的天气怎么样？" - 一般天气状况查询
- "帮我查询下天津的天气" - 带有间接请求的查询
- "成都今日空气质量" - 空气质量查询

系统通过分析查询中的关键词，如城市名称、天气相关术语和时间表达，来确定是否将查询路由到天气MCP服务。

## 使用方法

天气查询MCP服务已集成到InfinityOps系统的命令处理流程中。用户只需要使用自然语言询问天气相关问题，系统会自动识别并调用天气查询服务。

### 支持的查询语言

目前天气查询MCP服务**主要支持中文查询**。对于英文查询，可能会由系统的内置命令分析服务处理，而不是天气查询服务。

### 示例查询

以下是一些示例查询，展示如何使用天气查询MCP服务：

- 支持的中文查询：
  - "北京今天天气如何？"
  - "上海明天会下雨吗？"
  - "广州未来三天的气温是多少？"
  - "成都现在的湿度是多少？"
  - "武汉的天气怎么样？"
  - "天津的气温是多少？"
  - "帮我查询下北京的天气"
  - "查询一下上海今天的天气预报"

- 英文查询（目前由内置命令分析服务处理）：
  - "What is the weather in New York today?"
  - "Will it rain in London tomorrow?"
  - "Temperature in Tokyo next weekend"
  - "Weather forecast for San Francisco"

## 测试

可以使用以下命令测试天气查询MCP服务是否正常工作：

```bash
# 在backend目录下运行基本测试
pnpm test:weather-mcp

# 测试更复杂的天气查询
pnpm test:weather-queries

# 测试增强的天气查询检测系统
pnpm test:enhanced-weather
```

这些命令会初始化MCP模块，并向天气查询服务发送多个测试请求，然后输出处理结果。

## 故障排除

如果天气查询服务无法正常工作，请检查以下几点：

1. 确认天气MCP服务器正在运行，并且可以通过配置的URL访问
2. 验证环境变量是否正确配置
3. 检查日志文件中是否有相关错误信息
4. 使用测试命令测试服务连接

### 已知问题

1. **英文天气查询支持有限** - 当前版本的天气MCP服务主要支持中文查询。英文查询通常会由系统的内置命令分析服务处理。我们正在改进此功能，以便在未来版本中更好地支持英文查询。

## API参考

天气查询MCP服务实现了标准的MCP接口，包括：

- `GET /api/status` - 获取服务状态
- `POST /api/can-handle` - 检查是否可以处理请求
- `POST /api/process` - 处理天气查询请求
- `POST /api/handle-confirmation` - 处理确认响应

详细的API规范请参考[MCP服务器接入指南](./mcp-server-integration.md)。 