# InfinityOps 项目设计文档

## 项目概览

### 基本信息
- **项目名称**：InfinityOps
- **项目类型**：智能 SSH 终端
- **核心特点**：SSH 终端 + AI 中间层 + MCP 插件系统

### 项目简介
InfinityOps 是一个智能 SSH 终端工具，通过集成 AI 中间层和 MCP 插件系统，为用户提供更智能、更便捷的远程系统操作体验。它使用本地 Ollama AI 模型作为中间层，帮助用户理解和执行复杂的系统操作，并通过 MCP 插件系统调用各种服务来增强功能。

### 核心功能
1. **SSH 终端功能**
   - 标准 SSH 连接和会话管理
   - 实时命令执行和输出显示
   - 多会话管理

2. **AI 中间层功能**
   - 用户指令意图分析
   - MCP 服务选择和调用
   - 响应内容整合和优化
   - 上下文理解和管理

3. **MCP 插件系统**
   - 内置命令解析服务（随后端自动启动）
     - 自然语言到命令的转换
     - 操作步骤分解和解释
     - 命令建议和自动补全
     - 错误诊断和修复建议
   - 脚本生成和执行服务
   - 本地文件操作服务
   - 系统信息查询服务
   - 自定义工具服务
   - 远程服务调用
   - 第三方API集成（如天气查询）

4. **性能优化**
   - 本地缓存机制
   - 命令历史智能搜索
   - 性能监控和优化建议
   - 资源使用优化

5. **文档和帮助系统**
   - 内置帮助文档
   - 命令使用示例
   - 故障排除指南
   - 上下文相关帮助

6. **监控和诊断**
   - 系统资源监控
   - 性能瓶颈诊断
   - 问题自动诊断
   - 健康状态检查

### 技术栈

#### 前端技术
| 类别          | 技术选型                      |
|---------------|-----------------------------|
| 框架          | React + TypeScript + Vite   |
| 终端模拟      | xterm.js                    |
| UI 组件库     | shadcn/ui（Tailwind CSS）   |

#### 后端技术
| 类别          | 技术选型                      |
|---------------|-----------------------------|
| 框架          | Node.js + TypeScript        |
| AI 集成       | Ollama API                  |
| SSH 服务      | ssh2 (Node.js)              |
| 数据存储      | SQLite                      |
| MCP 插件系统  | 自定义实现                   |

#### 监控技术
| 类别          | 技术选型                      |
|---------------|-----------------------------|
| 监控          | Prometheus                  |
| 可视化        | Grafana                     |

### 系统架构

```plaintext
+-------------+       WebSocket/HTTPS       +----------------------+
|   前端 (SPA) | <------------------------> |   API 服务层         |
| React + TS   |                            |  • 会话管理          |
| xterm.js     |                            |  • 命令转发          |
+-------------+                            +----------------------+
                                                     |
                                                     v
                                          +----------------------+
                                          |      AI 中间层       |
                                          |  • Ollama 集成       |
                                          |  • 意图识别          |
                                          |  • MCP服务分发       |
                                          +----------------------+
                                                     |
                                                     v
                     +-----------------------------------------------+
                     |              MCP 插件系统                     |
                     |                                               |
+----------------------+  +----------------------+  +---------------+
| 内置命令解析服务      |  | 脚本生成和执行服务   |  | 其他MCP服务   |
| (后端启动自动加载)    |  |                    |  |               |
|  • 命令解析和生成     |  |  • 脚本编辑        |  |  • 文件操作   |
|  • 操作分解          |  |  • 执行管理        |  |  • 系统信息   |
|  • 命令建议          |  |  • 版本控制        |  |  • 天气查询   |
+----------------------+  +----------------------+  +---------------+
                     |                                               |
                     +-----------------------------------------------+
                                                     |
                                                     v
                                          +----------------------+
                                          |     SSH 服务层       |
                                          |  • 连接管理          |
                                          |  • 命令执行          |
                                          |  • 会话控制          |
                                          +----------------------+
```

### MCP 命令处理流程

```plaintext
+----------------------+                 +---------------------+
| 用户输入命令/自然语言 | --------------> |   前端 (SPA)        |
+----------------------+                 +---------------------+
                                                    |
                                                    v
+----------------------+                 +---------------------+
| 返回结果给用户       | <-------------- |   API 服务层        |
+----------------------+                 +---------------------+
         ^                                        |
         |                                        v
         |                               +---------------------+
         |                               |  AI 中间层意图识别  |
         |                               |  及MCP服务分发     |
         |                               +---------------------+
         |                                        |
         |                                        v
         |                      +----------------------------------+
         |                      |                                  |
         |           +---------------------+             +---------------------+
         |           | 内置命令解析服务    |             | 其他专用MCP服务     |
         +-----------|  • 命令解析        |<----------->|  • 文件操作         |
                     |  • 操作分解        |             |  • 脚本执行         |
                     |  • 命令建议        |             |  • 系统信息         |
                     +---------------------+             +---------------------+
```

### 开发路线图

| 阶段      | 时间范围        | 主要目标                                 |
|---------|---------------|----------------------------------------|
| Phase 1 | 1-2 周        | 基础 SSH 终端功能实现                      |
| Phase 2 | 2-3 周        | Ollama AI 集成和意图分发能力               |
| Phase 3 | 3-4 周        | MCP 插件系统和内置命令解析服务实现           |
| Phase 4 | 4-5 周        | 其他MCP服务实现                           |
| Phase 5 | 5-6 周        | 文档和帮助系统实现                          |
| Phase 6 | 6-7 周        | 测试和优化                                |

### 总结

InfinityOps 通过集成 AI 中间层和 MCP 插件系统，为用户提供了一个更智能、更便捷的 SSH 终端工具。它不仅能帮助用户更轻松地使用 Linux 系统，还能通过插件系统扩展功能，满足各种复杂的系统操作需求。

在新的设计中，前端将用户指令直接发送给AI中间层，由AI负责判断并分发给适当的MCP服务。命令解析作为一个内置的MCP服务，随后端启动自动加载，为系统提供核心的命令处理能力。这种架构使得系统更加模块化和灵活，同时保持了统一的服务调用模式。所有MCP服务都遵循统一的接口和生命周期管理，便于扩展和维护。


